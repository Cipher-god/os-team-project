<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FCFS Disk Scheduling</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="fcfStyle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.11/typed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
  <div class="scroll-up-btn">??
    <i class="fas fa-angle-up"></i>
  </div>
  <div class="center">
    <section>
      <a href="Demo_FCFS.html">
        <h1>FCFS DISK SCHEDULING</h1>
      </a>
      <form id="form">
        <div id="RequestQueue">REQUEST QUERIES: </div>
        <br>
        <label for="queries">Queries:</label>

        <div id="queryInputs">
          <input width="5" type="number" id="request" name="query">
        </div>

        <button type="button" id="addQuery" style="">Add</button>
        <br><br>
        <label for="head">Head Position:</label>
        <input type="number" id="head" name="head" required><br><br>

        <button id="submit" type="submit" style="">Submit</button>
        <button id="ShowGraph" onclick="sendData()">Show Graph</button>
        <a href="Demo_FCFS.html" id="Reset" style="">Reset</a>
        <div id="seektime"></div>
      </form>

      <div id="Graph" style="visibility: hidden;">
        <canvas id="myChart"></canvas>
      </div>

    </section>
  </div>
</body>
<script>

  var form = document.getElementById('form');
  var headInput = document.getElementById('head');
  var queryInputs = document.getElementById('queryInputs');
  var addQueryButton = document.getElementById('addQuery');
  var chartContainer = document.getElementById('myChart');
  var chart = null;
  var ShowGraph = document.getElementById('ShowGraph');
  var submit = document.getElementById('submit');
  var Reset = document.getElementById('Reset');
  const requestInput = document.getElementById('request');

  var queries = [];
  addQueryButton.addEventListener('click', function () {
    //var newQueryInput = document.createElement('input');
    //newQueryInput.type = 'number';
    //newQueryInput.name = 'query';
    //newQueryInput.required = true;
    //queryInputs.appendChild(newQueryInput);

    const request = requestInput.value;
    if (request === "") {
      alert("Please fill the Query");
    } else {
      queries.push(request);
      requestInput.value = null;

      document.getElementById("RequestQueue").innerHTML = "REQUEST QUERIES: " + queries;
    }
  });
  ShowGraph.addEventListener('click', function () {
    form.style.marginLeft = "10%";
    ShowGraph.style.display = "none";
    submit.style.display = "none";
    Reset.style.visibility = "visible";
    document.getElementById('Graph').style.visibility = "visible";
  });

  form.addEventListener('submit', function (event) {
    event.preventDefault();
    var head = parseInt(headInput.value);
    
    var chartData = generateChartData(head, queries);
    renderChart(chartData);
    calculateSeekTime();

  });

  function sendData(){
    fetch("http://localhost:5500/", {
      method: 'POST', 
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ 
          Request_ID: null, // since it's auto-increment, set to null
          Queries: query,
          Head_Position: head,
          Total_Seek_Time: seekTime, 
          Avg_Seek_Time: seekTime/queries.length
       }),
    }).then((response) => response.json())
      .then((data) => {
        console.log('Success:', data);
      })
      .catch((error) => {
        console.error('Error:', error);
      });
  }

  function generateChartData(head, queries) {
    var chartData = {};
    chartData.labels = ['Head'];
    chartData.datasets = [{
      label: 'Cylinder',
      data: [head]
    }];

    for (var i = 0; i < queries.length; i++) {
      chartData.labels.push('Request ' + (i + 1));
      chartData.datasets[0].data.push(queries[i]);
    }

    return chartData;
  }

  function renderChart(chartData) {
    if (chart) {
      chart.destroy();
    }

    chart = new Chart(chartContainer, {
      type: 'line',
      data: chartData,
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        }
      }
    });
  }
  function calculateSeekTime() {

    // Calculate seek time
    var head = headInput.value;
    let seekTime = 0;
    for (let i = 0; i < queries.length; i++) {
      seekTime += Math.abs(queries[i] - head);
      head = queries[i];
    }

    // Display result
    document.getElementById("seektime").innerHTML = "<br><br><strong>Total seek time: </strong>" + seekTime + "<br>      <strong>Average seek time: </strong>" + (seekTime / queries.length);
  }
</script>

</html>
